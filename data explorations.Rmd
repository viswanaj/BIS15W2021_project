---
title: "data exploration"
output: 
  html_document: 
    keep_md: yes
---



```{r}
if (!require("tidyverse")) install.packages('tidyverse')
```

```{r message=FALSE, warning=FALSE}
library("tidyverse")
library("shiny")
library("shinydashboard")
library("janitor")
library("naniar")
```






```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.



```{r}
library(tidyverse)
library(here)
library(janitor)
```


```{r}
food_data<-read.csv("food and covid data/Fat_Supply_Quantity_Data.csv")
food_data
```







```{r}
kg_gen_not<-read.csv("food and covid data/Food_Supply_Quantity_kg_Data_general_notation.csv")
```



```{r}
summary(kg_gen_not)
```


```{r}
kg_gen_not%>%
  select(Country,Obesity)
```

```{r}
kg_gen_not%>%
  select(Country,Obesity)%>%
  arrange(desc(Obesity))%>%
  head(10)%>%
  ggplot(aes(x=Country,y=Obesity))+
  geom_col()+
   theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 60, hjust=1))
```

#look at island nations to see covid death and recovery rates





```{r}
kg_gen_not%>%
  select(Country,Obesity,Deaths)%>%
  arrange(desc(Obesity))%>%
  tail(10)%>%
  ggplot(aes(x=Country,y=Obesity))+
  geom_col()+
   theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 60, hjust=1))
```

```{r}
kg_gen_not%>%
  select(Country,Obesity,Deaths)%>%
  filter(Obesity!="NA")%>%
  arrange(desc(Obesity))%>%
  tail(10)
```

```{r}
kg_gen_not%>%
  select(Country,Obesity,Deaths)%>%
  filter(Obesity!="NA")%>%
  arrange(desc(Obesity))%>%
  tail(10)%>%
  ggplot(aes(x=Obesity,y=Deaths,fill=Country))+
  geom_col()
```


```{r}
kg_gen_not%>%
  select(Country,Obesity,Deaths)%>%
  arrange(desc(Obesity))%>%
  tail(10)%>%
  ggplot(aes(x=Country,y=Obesity))+
  geom_col()+
   theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 60, hjust=1))
```





```{r}
kg_gen_not%>%
  select(Obesity,Country,Confirmed,Deaths,Recovered)%>%
  filter(Recovered!=0)%>%
  filter(Deaths!=0)%>%
  summarise(Country,recovery_to_death_ratio=Recovered/Deaths)%>%
  arrange(desc(recovery_to_death_ratio))%>%
  head(10)
  
```



```{r}
kg_gen_not%>%
  select(Obesity,Country,Confirmed,Deaths,Recovered)%>%
  filter(Recovered!=0)%>%
  filter(Deaths!=0)%>%
  summarise(Country,recovery_to_death_ratio=Recovered/Deaths)%>%
  arrange(desc(recovery_to_death_ratio))%>%
  head(10)%>%
  ggplot(aes(x=Country,y=recovery_to_death_ratio))+
  geom_col()+
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 60, hjust=1))
```

#observe the diets and and obesity rates of high recovery nations

```{r}
high_recovery_nations<-kg_gen_not%>%
  filter(Country=="Mongolia"|Country== "United Arab Emirates"|Country=="Maldives"|Country=="Malaysia"|Country=="Thailand"|Country=="Iceland"|Country=="Sri Lanka"|Country=="Cote d'Ivoire"|Country=="Guinea"|Country=="Kuwait")
```


```{r}
high_recovery_nations%>%
  select(Obesity,Country,Confirmed,Deaths,Recovered)%>%
  filter(Recovered!=0)%>%
  filter(Deaths!=0)%>%
  summarise(Country,Obesity,recovery_to_death_ratio=Recovered/Deaths)%>%
  ggplot(aes(x=Obesity,y=recovery_to_death_ratio,fill=Country))+
  geom_col()
```

#so this is kinda weird, mongolia has high recovery and is moderate in obesity scale, maybe it has to do with the specifics of their diet
#for now lets look at highest infection rate countries

```{r}
#high obesity
kg_gen_not%>%
  arrange(desc(Deaths))%>%
  summarise(Country,Confirmed,Recovered,Deaths,Obesity)%>%
  head(10)
```

```{r}
high_obesity<-kg_gen_not%>%
  arrange(desc(Deaths))%>%
  summarise(Country,Confirmed,Recovered,Deaths,Obesity)%>%
  head(10)
```


#need to fix USA's recovered column that looks like an error 

```{r}
#low obesity
kg_gen_not%>%
  select(Country,Confirmed,Recovered,Deaths,Obesity)%>%
  filter(Obesity!="NA")%>%
  arrange(desc(Obesity))%>%
  tail(10)
```

```{r}
low_obesity<-kg_gen_not%>%
  select(Country,Confirmed,Recovered,Deaths,Obesity)%>%
  filter(Obesity!="NA")%>%
  arrange(desc(Obesity))%>%
  tail(10)
```


```{r}
kg_gen_not%>%
  arrange(desc(Deaths))%>%
  summarise(Country,Confirmed,Recovered,Deaths,Obesity)%>%
  head(10)%>%
    ggplot(aes(x=Obesity,y=Deaths,fill=Country))+
  geom_col()
```



```{r}
#comparing low vs high obesity relative to covid death rate by countries
high_and_low_obesity<-rbind(low_obesity,high_obesity)

high_and_low_obesity
```


```{r}
names(high_and_low_obesity)
```


```{r,eval=FALSE,echo=TRUE}
library(shiny)

ui_1 <- dashboardPage(
  dashboardHeader(title = "Test"),
  dashboardSidebar(),
  dashboardBody(
    selectInput("x","Select X variable",choices = c("Population","Recovered","Obesity","Deaths"),
              selected = "Deaths"),
 selectInput("y","Select y variable",choices = c("Population","Recovered","Obesity","Deaths"),
              selected = "Deaths"),
 box(title = "Test", width = 10,
  plotOutput("plot",width = "1000px",height = "900px")
    
)
) 
)

server_1 <- function(input, output) {
  output$plot<-renderPlot({
  ggplot(high_and_low_obesity,aes_string(x=input$x,y=input$y, color="Country")) + geom_point(size=10)+ theme_light(base_size = 18)
    })
    #session$onSessionEnded(stopApp)
    }

shinyApp(ui_1,server_1)
```


#population vs number of cases pick out the ones with the highest 



```{r}
names(kg_gen_not)
```
"Country","Alcoholic.Beverages","Animal.fats","Animal.Products","Aquatic.Products..Other","Cereals...Excluding.Beer","Eggs","Fish..Seafood",
"Fruits...Excluding.Wine","Meat","Milk...Excluding.Butter","Miscellaneous","Offals","Oilcrops","Pulses","Spices","Starchy.Roots","Stimulants","Sugar...Sweeteners","Sugar.Crops" "Treenuts","Vegetable.Oils","Vegetables","Vegetal.Products","Obesity","Undernourished","Confirmed","Deaths","Recovered","Active","Population","Unit..all.except.Population."

#app for general overview
```{r,eval=FALSE,echo=TRUE} 
library(shiny)

ui_1 <- dashboardPage(
  dashboardHeader(title = "Test"),
  dashboardSidebar(),
  dashboardBody(
    selectInput("x","Select X variable",choices=c("Country","Alcoholic.Beverages","Animal.fats","Animal.Products","Aquatic.Products..Other","Cereals...Excluding.Beer","Eggs","Fish..Seafood","Fruits...Excluding.Wine","Meat","Milk...Excluding.Butter","Miscellaneous","Offals","Oilcrops","Pulses","Spices","Starchy.Roots","Stimulants","Sugar...Sweeteners","Sugar.Crops","Treenuts","Vegetable.Oils","Vegetables","Vegetal.Products","Obesity","Undernourished","Confirmed","Deaths","Recovered","Active","Population","Unit..all.except.Population."),
              selected = "Deaths"),
 selectInput("y","Select y variable",choices = c("Country","Alcoholic.Beverages","Animal.fats","Animal.Products","Aquatic.Products..Other","Cereals...Excluding.Beer","Eggs","Fish..Seafood",
"Fruits...Excluding.Wine","Meat","Milk...Excluding.Butter","Miscellaneous","Offals","Oilcrops","Pulses","Spices","Starchy.Roots","Stimulants","Sugar...Sweeteners","Sugar.Crops","Treenuts","Vegetable.Oils","Vegetables","Vegetal.Products","Obesity","Undernourished","Confirmed","Deaths","Recovered","Active","Population","Unit..all.except.Population."),
              selected = "Deaths"),
 box(title = "Test", width = 10,
  plotOutput("plot",width = "1000px",height = "900px")
    
    
)
) 
)

server_1 <- function(input, output) {
  output$plot<-renderPlot({
  ggplot(kg_gen_not,aes_string(x=input$x,y=input$y)) + geom_point(size=4.5)+ theme_light(base_size = 18)+geom_smooth(method = lm)
    })
    #session$onSessionEnded(stopApp)
    }

shinyApp(ui_1,server_1)
```












