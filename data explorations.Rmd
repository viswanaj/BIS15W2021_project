---
title: "data exploration"
output: 
  html_document: 
    keep_md: yes
---



```{r}
if (!require("tidyverse")) install.packages('tidyverse')
```

```{r message=FALSE, warning=FALSE}
library("tidyverse")
library("shiny")
library("shinydashboard")
library("janitor")
library("naniar")
```






```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(here)
library(janitor)
```


```{r}
food_data<-read.csv("food and covid data/Food_Supply_Quantity_kg_Data_general_notation.csv")
food_data
```
```{r}
food_data %>% 
  group_by(Country) %>%
  ggplot(aes(Obesity,Deaths))+geom_point()+geom_smooth(method = lm)
```
```{r}
food_data %>% 
  group_by(Country) %>%
  ggplot(aes(Vegetal.Products,Deaths))+geom_point()+geom_smooth(method = lm)
```
```{r}
food_data %>% 
  group_by(Country) %>%
  ggplot(aes(Meat,Deaths))+geom_point()+geom_smooth(method = lm)
```
```{r}
food_data %>% 
  select(Alcoholic.Beverages, Country) %>% 
  arrange(desc(Alcoholic.Beverages))
```

```{r}
food_data %>% 
  group_by(Country) %>%
  ggplot(aes(Obesity,Deaths))+geom_point()+geom_smooth()
```
```{r}
food_data %>% 
  select(Obesity,Country) %>% 
  arrange(desc(Obesity)) %>% 
  mutate(island=)
```
```{r}
island_food_data<- food_data %>% 
  filter(Country== "Samoa"| Country=="United Kingdom"| Country=="Fiji" | Country=="Japan"| Country=="Australia"| Country=="New Zealand"| Country=="Kiribati"| Country=="Iceland"| Country=="Philippines") %>% 
   mutate(island= TRUE)
island_food_data
```


```{r}
non_island_food_data<- food_data %>% 
   filter( Country!="Australia", Country!="Samoa", Country!="United Kingdom", Country!="New Zealand", Country!="Kiribati", Country!="Iceland", Country!="Philippines", Country!="Fiji", Country!="Japan" ) %>%
  mutate(island= FALSE)
non_island_food_data
```
```{r}
food_data %>% 
  filter(Obesity>37) %>% 
  select(Country, Confirmed, Deaths, Recovered)
```

```{r}
island_food_complete <- rbind(non_island_food_data, island_food_data)
island_food_complete
```
```{r}
island_food_complete %>% 
  select(Country, Undernourished) %>% 
  arrange(desc(Undernourished))
```
```{r}
island_food_complete %>% 
  filter(Country!= "United Kingdom") %>% 
  ggplot(aes(Obesity,Deaths,color=island))+geom_point()+geom_smooth(method = lm)
```
```{r}
island_food_complete %>% 
  ggplot(aes(Obesity,Deaths,color=island))+geom_point()+geom_smooth(method = lm)
```


```{r}
well_nourished_countries<-food_data %>% 
  filter(Undernourished== "<2.5") %>% 
  cbind(2.5) %>% 
  mutate(Undernourished_numeric= mean(2.5)) %>% 
  select(!"2.5")
```

```{r}
food_experiment<- food_data %>% 
  filter(Undernourished != "<2.5")

```
```{r}
  food_experiment<-food_experiment %>% 
  mutate(Undernourished_numeric=as.numeric(as.character(food_experiment$Undernourished)))
  
```
```{r}
nourishment_complete <- rbind(food_experiment, well_nourished_countries)
nourishment_complete
```
```{r}
is.numeric(nourishment_complete$Undernourished_numeric)
```

```{r}
nourishment_complete <- nourishment_complete %>% 
             mutate(nourishment_catagory= case_when(Undernourished_numeric <=2.5 ~ "low",
                                              Undernourished_numeric > 2.5 & Undernourished_numeric <= 15 ~ "medium",
                                              Undernourished_numeric > 15 ~ "high"))
nourishment_complete
```
```{r}
nourishment_complete %>% 
  ggplot(aes(Obesity, Deaths, color= nourishment_catagory))+geom_point()+geom_smooth(method = lm)
```













```{r}
kg_gen_not<-read.csv("food and covid data/Food_Supply_Quantity_kg_Data_general_notation.csv")
```



```{r}
summary(kg_gen_not)
```


```{r}
kg_gen_not%>%
  select(Country,Obesity)
```

```{r}
kg_gen_not%>%
  select(Country,Obesity)%>%
  arrange(desc(Obesity))%>%
  head(10)%>%
  ggplot(aes(x=Country,y=Obesity))+
  geom_col()+
   theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 60, hjust=1))
```

#look at island nations to see covid death and recovery rates





```{r}
kg_gen_not%>%
  select(Country,Obesity,Deaths)%>%
  arrange(desc(Obesity))%>%
  tail(10)%>%
  ggplot(aes(x=Country,y=Obesity))+
  geom_col()+
   theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 60, hjust=1))
```

```{r}
kg_gen_not%>%
  select(Country,Obesity,Deaths)%>%
  filter(Obesity!="NA")%>%
  arrange(desc(Obesity))%>%
  tail(10)
```

```{r}
kg_gen_not%>%
  select(Country,Obesity,Deaths)%>%
  filter(Obesity!="NA")%>%
  arrange(desc(Obesity))%>%
  tail(10)%>%
  ggplot(aes(x=Obesity,y=Deaths,fill=Country))+
  geom_col()
```


```{r}
kg_gen_not%>%
  select(Country,Obesity,Deaths)%>%
  arrange(desc(Obesity))%>%
  tail(10)%>%
  ggplot(aes(x=Country,y=Obesity))+
  geom_col()+
   theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 60, hjust=1))
```





```{r}
kg_gen_not%>%
  select(Obesity,Country,Confirmed,Deaths,Recovered)%>%
  filter(Recovered!=0)%>%
  filter(Deaths!=0)%>%
  summarise(Country,recovery_to_death_ratio=Recovered/Deaths)%>%
  arrange(desc(recovery_to_death_ratio))%>%
  head(10)
  
```



```{r}
kg_gen_not%>%
  select(Obesity,Country,Confirmed,Deaths,Recovered)%>%
  filter(Recovered!=0)%>%
  filter(Deaths!=0)%>%
  summarise(Country,recovery_to_death_ratio=Recovered/Deaths)%>%
  arrange(desc(recovery_to_death_ratio))%>%
  head(10)%>%
  ggplot(aes(x=Country,y=recovery_to_death_ratio))+
  geom_col()+
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 60, hjust=1))
```

#observe the diets and and obesity rates of high recovery nations

```{r}
high_recovery_nations<-kg_gen_not%>%
  filter(Country=="Mongolia"|Country== "United Arab Emirates"|Country=="Maldives"|Country=="Malaysia"|Country=="Thailand"|Country=="Iceland"|Country=="Sri Lanka"|Country=="Cote d'Ivoire"|Country=="Guinea"|Country=="Kuwait")
```


```{r}
high_recovery_nations%>%
  select(Obesity,Country,Confirmed,Deaths,Recovered)%>%
  filter(Recovered!=0)%>%
  filter(Deaths!=0)%>%
  summarise(Country,Obesity,recovery_to_death_ratio=Recovered/Deaths)%>%
  ggplot(aes(x=Obesity,y=recovery_to_death_ratio,fill=Country))+
  geom_col()
```

#so this is kinda weird, mongolia has high recovery and is moderate in obesity scale, maybe it has to do with the specifics of their diet
#for now lets look at highest infection rate countries

```{r}
#high obesity
kg_gen_not%>%
  arrange(desc(Deaths))%>%
  summarise(Country,Confirmed,Recovered,Deaths,Obesity)%>%
  head(10)
```

```{r}
high_obesity<-kg_gen_not%>%
  arrange(desc(Deaths))%>%
  summarise(Country,Confirmed,Recovered,Deaths,Obesity)%>%
  head(10)
```


#need to fix USA's recovered column that looks like an error 

```{r}
#low obesity
kg_gen_not%>%
  select(Country,Confirmed,Recovered,Deaths,Obesity)%>%
  filter(Obesity!="NA")%>%
  arrange(desc(Obesity))%>%
  tail(10)
```

```{r}
low_obesity<-kg_gen_not%>%
  select(Country,Confirmed,Recovered,Deaths,Obesity)%>%
  filter(Obesity!="NA")%>%
  arrange(desc(Obesity))%>%
  tail(10)
```


```{r}
kg_gen_not%>%
  arrange(desc(Deaths))%>%
  summarise(Country,Confirmed,Recovered,Deaths,Obesity)%>%
  head(10)%>%
    ggplot(aes(x=Obesity,y=Deaths,fill=Country))+
  geom_col()
```



```{r}
#comparing low vs high obesity relative to covid death rate by countries
high_and_low_obesity<-rbind(low_obesity,high_obesity)

high_and_low_obesity
```


```{r}
names(high_and_low_obesity)
```


```{r,eval=FALSE,echo=TRUE}
library(shiny)

ui_1 <- dashboardPage(
  dashboardHeader(title = "Test"),
  dashboardSidebar(),
  dashboardBody(
    selectInput("x","Select X variable",choices = c("Population","Recovered","Obesity","Deaths"),
              selected = "Deaths"),
 selectInput("y","Select y variable",choices = c("Population","Recovered","Obesity","Deaths"),
              selected = "Deaths"),
 box(title = "Test", width = 10,
  plotOutput("plot",width = "1000px",height = "900px")
    
)
) 
)

server_1 <- function(input, output) {
  output$plot<-renderPlot({
  ggplot(high_and_low_obesity,aes_string(x=input$x,y=input$y, color="Country")) + geom_point(size=10)+ theme_light(base_size = 18)
    })
    #session$onSessionEnded(stopApp)
    }

shinyApp(ui_1,server_1)
```


#population vs number of cases pick out the ones with the highest 



```{r}
names(kg_gen_not)
```
"Country","Alcoholic.Beverages","Animal.fats","Animal.Products","Aquatic.Products..Other","Cereals...Excluding.Beer","Eggs","Fish..Seafood",
"Fruits...Excluding.Wine","Meat","Milk...Excluding.Butter","Miscellaneous","Offals","Oilcrops","Pulses","Spices","Starchy.Roots","Stimulants","Sugar...Sweeteners","Sugar.Crops" "Treenuts","Vegetable.Oils","Vegetables","Vegetal.Products","Obesity","Undernourished","Confirmed","Deaths","Recovered","Active","Population","Unit..all.except.Population."

#app for general overview
```{r,eval=FALSE,echo=TRUE} 
library(shiny)

ui_1 <- dashboardPage(
  dashboardHeader(title = "Test"),
  dashboardSidebar(),
  dashboardBody(
    selectInput("x","Select X variable",choices=c("Country","Alcoholic.Beverages","Animal.fats","Animal.Products","Aquatic.Products..Other","Cereals...Excluding.Beer","Eggs","Fish..Seafood","Fruits...Excluding.Wine","Meat","Milk...Excluding.Butter","Miscellaneous","Offals","Oilcrops","Pulses","Spices","Starchy.Roots","Stimulants","Sugar...Sweeteners","Sugar.Crops","Treenuts","Vegetable.Oils","Vegetables","Vegetal.Products","Obesity","Undernourished","Confirmed","Deaths","Recovered","Active","Population","Unit..all.except.Population."),
              selected = "Deaths"),
 selectInput("y","Select y variable",choices = c("Country","Alcoholic.Beverages","Animal.fats","Animal.Products","Aquatic.Products..Other","Cereals...Excluding.Beer","Eggs","Fish..Seafood",
"Fruits...Excluding.Wine","Meat","Milk...Excluding.Butter","Miscellaneous","Offals","Oilcrops","Pulses","Spices","Starchy.Roots","Stimulants","Sugar...Sweeteners","Sugar.Crops","Treenuts","Vegetable.Oils","Vegetables","Vegetal.Products","Obesity","Undernourished","Confirmed","Deaths","Recovered","Active","Population","Unit..all.except.Population."),
              selected = "Deaths"),
 box(title = "Test", width = 10,
  plotOutput("plot",width = "1000px",height = "900px")
    
    
)
) 
)

server_1 <- function(input, output) {
  output$plot<-renderPlot({
  ggplot(kg_gen_not,aes_string(x=input$x,y=input$y)) + geom_point(size=4.5)+ theme_light(base_size = 18)+geom_smooth(method = lm)
    })
    #session$onSessionEnded(stopApp)
    }

shinyApp(ui_1,server_1)
```












